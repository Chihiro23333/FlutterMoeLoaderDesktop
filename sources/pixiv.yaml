meta:
  name: "pixiv.net"
  type: "assets"
  headers:
    Referer: "https://www.pixiv.net/"
    User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"

display:
  columnCount: 6
  aspectRatio: 1

url:
  home: {link: "https://www.pixiv.net/ranking.php?p=${page}&format=json" }
  search: {link: "https://www.pixiv.net/ajax/search/artworks/${tag}?word=${tag}&order=date_d&mode=all&p=${page}&csw=0&s_mode=s_tag_full&type=all&lang=z"}

homePage:
  onParseResult:
    contentType: "json"
    list:
      getNodes: { jsonpath: "$.contents" }
      foreach:
        coverUrl:
          get: { jsonpath: ".url" }
        href:
          get: { jsonpath: ".illust_id" }
          format:
            - concat: { start: "https://www.pixiv.net/artworks/", end: "" }
        width:
          get: { jsonpath: ".width" }
        height:
          get: { jsonpath: ".height" }
        tags:
          list:
            getNodes: { jsonpath: ".tags" }

searchPage:
  onParseResult:
    contentType: "json"
    list:
      getNodes: { jsonpath: "$..illustManga.data" }
      foreach:
        coverUrl:
          get: { jsonpath: ".url" }
        href:
          get: { jsonpath: ".id" }
          format:
            - concat: { start: "https://www.pixiv.net/artworks/", end: "" }
        tags:
          list:
            getNodes: { jsonpath: ".tags" }

detailPage:
  onValidateResult:
    result:
      - { regex: '"regular":null', action: "login" }
  onPreprocessResult:
    contentType: "html"
    get: { cssSelector: "#meta-preload-data", attr: "content" }
  onParseResult:
    contentType: "json"
    object:
      url:
        get: { jsonpath: "$..illust..regular" }
      rawUrl:
        get: { jsonpath: "$..illust..original" }
      tags:
        list:
          getNodes: { jsonpath: "$..illust..userIllusts..tags" }